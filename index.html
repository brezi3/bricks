<html>

<head>
    <title>BRICKS</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="application/javascript">


        function drawIt() {

            var x = 150;
            var y = 150;
            var dx = 2;
            var dy = 4;
            var WIDTH;
            var HEIGHT;
            var r = 10;
            var ctx;
            var paddlex;
            var paddleh;
            var paddlew;
            var tocke;
            var IntervalId;
            //timer
            var sekunde;
            var sekundeI;
            var minuteI;
            var intTimer;
            var izpisTimer;
            var start = true;

            function init_paddle() {
                paddlex = 2;
                paddleh = 10;
                paddlew = 75;
            }

            function init() {
                ctx = $('#canvas')[0].getContext("2d");
                // dodajanje kode v metodo init
                tocke = 0;
                start=false;
                sekunde = 0;
                izpisTimer = "00:00";
                intTimer = setInterval(timer, 1000);

                $("#tocke").html(tocke);
                WIDTH = $("#canvas").width();
                HEIGHT = $("#canvas").height();
                //welcome sweet alert
                Swal.fire({
                    title: 'WELCOME TO BRICKS GAME!',
                    html: 'Click "START" and try to break all the bricks!',
                    confirmButtonColor: 'rgb(204, 85, 0)',
                    color: 'black',
                    confirmButtonText: 'START'
                }).then((result) => {
                    if (result.isConfirmed) {
                        //start igre
                        start=true;
                        return intervalId=setInterval(draw, 10);
                    }
                });

            }

            function circle(x, y, r) {
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2, true);
                ctx.closePath();
                ctx.fill();
            }

            function rect(x, y, w, h) {
                ctx.beginPath();
                ctx.rect(x, y, w, h);
                ctx.closePath();
                ctx.fill();
            }

            function clear() {
                ctx.clearRect(0, 0, WIDTH, HEIGHT);
            }
            var rightDown = false;
            var leftDown = false;

            //nastavljanje leve in desne tipke
            function onKeyDown(evt) {
                if (evt.keyCode == 39)
                    rightDown = true;
                else if (evt.keyCode == 37) leftDown = true;
            }

            function onKeyUp(evt) {
                if (evt.keyCode == 39)
                    rightDown = false;
                else if (evt.keyCode == 37) leftDown = false;
            }
            $(document).keydown(onKeyDown);
            $(document).keyup(onKeyUp);

            //premikanje miske
            var canvasMinX;
            var canvasMaxX;
            function init_mouse() {
                canvasMinX = $("canvas").offset().left;
                canvasMaxX = canvasMinX + WIDTH;
            }

            function onMouseMove(evt) {
                if (evt.pageX > canvasMinX && evt.pageX < canvasMaxX) {
                    paddlex = evt.pageX - canvasMinX;
                }
            }
            $(document).mousemove(onMouseMove);


            var bricks;
            var NROWS;
            var NCOLS;
            var BRICKWIDTH;
            var BRICKHEIGHT;
            var PADDING;

            function initbricks() { //inicializacija opek - polnjenje v tabelo
                NROWS = 5;
                NCOLS = 5;
                BRICKWIDTH = (WIDTH / NCOLS) - 1;
                BRICKHEIGHT = 15;
                PADDING = 1;
                bricks = new Array(NROWS);
                brickPoints = [5, 4, 3, 2, 1]; //tocke za vsako vrstico
                for (i = 0; i < NROWS; i++) {
                    bricks[i] = new Array(NCOLS);
                    for (j = 0; j < NCOLS; j++) {
                        bricks[i][j] = 1;
                    }
                }
            }

            function timer() {
                if (start == true) {
                    sekunde++;

                    sekundeI = ((sekundeI = (sekunde % 60)) > 9) ? sekundeI : "0" + sekundeI;
                    minuteI = ((minuteI = Math.floor(sekunde / 60)) > 9) ? minuteI : "0" + minuteI;
                    izpisTimer = minuteI + ":" + sekundeI;

                    $("#cas").html(izpisTimer);
                }
                else {
                    sekunde = 0;
                    //izpisTimer = "00:00";
                    $("#cas").html(izpisTimer);
                }
            }

            //END LIBRARY CODE
            function draw() {
                clear();
                circle(x, y, 10);
                //premik ploščice levo in desno
                if (rightDown) {
                    if ((paddlex + paddlew) < WIDTH) {
                        paddlex += 5;
                    } else {
                        paddlex = WIDTH - paddlew;
                    }
                }
                else if (leftDown) {
                    if (paddlex > 0) {
                        paddlex -= 5;
                    } else {
                        paddlex = 0;
                    }
                }
                rect(paddlex, HEIGHT - paddleh, paddlew, paddleh);

                //riši opeke
                for (i = 0; i < NROWS; i++) {
                    for (j = 0; j < NCOLS; j++) {
                        if (bricks[i][j] == 1) {
                            rect((j * (BRICKWIDTH + PADDING)) + PADDING,
                                (i * (BRICKHEIGHT + PADDING)) + PADDING,
                                BRICKWIDTH, BRICKHEIGHT);
                        }
                    }
                }

                rowheight = BRICKHEIGHT + PADDING / 2; //Smo zadeli opeko?
                colwidth = BRICKWIDTH + PADDING / 2;
                row = Math.floor(y / rowheight);
                col = Math.floor(x / colwidth);
                //Če smo zadeli opeko, vrni povratno kroglo in označi v tabeli, da opeke ni več
                if (y < NROWS * rowheight && row >= 0 && col >= 0 && bricks[row][col] == 1) {
                    dy = -dy; bricks[row][col] = 0;
                    var points = brickPoints[row]; // tocke za vrstico
                    tocke += points;
                    $("#tocke").html(tocke);
                }

                if (x + dx > WIDTH - r || x + dx < 0 + r)
                    dx = -dx;

                if (y + dy < 0 + r)
                    dy = -dy;

                else if (y + dy > HEIGHT - r) {
                    if (x > paddlex && x < paddlex + paddlew) {
                        dx = 8 * ((x - (paddlex + paddlew / 2)) / paddlew);
                        dy = -dy;
                        start = true;
                        paddleEnabled = true;
                    } else {
                        start = false;
                        Swal.fire({
                            title: 'GAME OVER!',
                            html: `The ball touched the ground! You can try again! <br> Score: ${tocke}<br>Time: ${izpisTimer}`,                            
                            icon: 'error',
                            color: 'black',
                            background: 'aliceblue',
                            confirmButtonColor: 'rgb(204, 85, 0)',
                            confirmButtonText: 'DO BETTER NOW',
                            backdrop: `rgba(204, 85, 0,0.2)`
                            
                        }).then((result) => {
                            if (result.isConfirmed) {
                                location.reload();
                            }
                        });
                        dx = 0;
                        dy = 0; //mogu sem dat to pred clearInterval ker drugace se sweetalert ne pojavi!
                        clearInterval(intervalId);
                    }


                }
                //pogleda ce so vse mozne tocke zadete
                if (tocke >= 75) {
                    start = false; // ustavi igro
                    clearInterval(intervalId);
                    // Show sweet alert
                    Swal.fire({
                        title: 'Congratulations!',
                        html: `You have reached 75 points!<br>Time: ${izpisTimer}`,
                        icon: 'success',
                        confirmButtonColor: 'rgb(204, 85, 0)',
                        backdrop: `rgba(204, 85, 0,0.2)`
                    }).then((result) => {
                        if (result.isConfirmed) {
                            dx = 0;
                            dy = 0;                       
                            location.reload(); // Reload the page to restart the game
                        }
                    });

                }

                x += dx;
                y += dy;

            }
            init_paddle();
            init();
            init_mouse();
            initbricks();
        }
    </script>
</head>

<body onload="drawIt()">
    <p>BRICKS</p>
    <div id="center">
        <canvas id="canvas" width="600" height="500"></canvas>
    </div>
    <div class="centriraj">
        <p class="tocke">TOČKE: <mark id="tocke">0</mark></p>
        <p class="cas">ČAS: <mark id="cas">00:00</mark></p>
    </div>
</body>

</html>